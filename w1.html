<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Why Clip & Convert to uint8? â€” Concept Note</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=Literata:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0f1a;
    --card: #141828;
    --card2: #1a2035;
    --accent: #5bf0c8;
    --accent2: #ff6b6b;
    --accent3: #ffc857;
    --accent4: #74b9ff;
    --text: #f5f7ff;
    --muted: #b8c6de;
    --border: rgba(91,240,200,0.15);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Literata', Georgia, serif;
    font-size: 16px;
    line-height: 1.8;
    padding: 40px 24px 60px;
  }

  .container { max-width: 680px; margin: 0 auto; }

  .label {
    display: inline-block;
    background: rgba(116,185,255,0.12);
    color: var(--accent4);
    border: 1px solid rgba(116,185,255,0.3);
    padding: 3px 14px;
    border-radius: 100px;
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 16px;
  }

  h1 {
    font-family: 'Syne', sans-serif;
    font-size: 1.7rem;
    font-weight: 800;
    color: var(--text);
    margin-bottom: 6px;
    line-height: 1.3;
  }

  h1 span { color: var(--accent); }

  .subtitle {
    color: var(--muted);
    font-size: 0.95rem;
    margin-bottom: 36px;
    padding-bottom: 24px;
    border-bottom: 1px solid var(--border);
  }

  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 22px 26px;
    margin-bottom: 16px;
  }

  .card p { color: var(--muted); margin-top: 10px; }
  .card p:first-child { margin-top: 0; }
  .card strong { color: var(--text); }

  .highlight {
    background: rgba(91,240,200,0.07);
    border-left: 3px solid var(--accent);
    border-radius: 0 10px 10px 0;
    padding: 16px 20px;
    margin-bottom: 16px;
    color: var(--muted);
  }
  .highlight strong { color: var(--accent); }

  .danger {
    background: rgba(255,107,107,0.07);
    border-left: 3px solid var(--accent2);
    border-radius: 0 10px 10px 0;
    padding: 16px 20px;
    margin-bottom: 16px;
    color: var(--muted);
  }
  .danger strong { color: var(--accent2); }

  .callout {
    background: rgba(255,200,87,0.07);
    border: 1px solid rgba(255,200,87,0.2);
    border-radius: 12px;
    padding: 18px 22px;
    margin-bottom: 16px;
    color: var(--muted);
  }
  .callout .callout-label {
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--accent3);
    margin-bottom: 8px;
  }

  .compare {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 16px;
  }

  .compare-box {
    background: var(--card2);
    border-radius: 12px;
    padding: 18px 20px;
    border: 1px solid var(--border);
  }

  .compare-box .tag {
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .compare-box.issue1 .tag { color: var(--accent4); }
  .compare-box.issue2 .tag { color: var(--accent2); }
  .compare-box p { color: var(--muted); font-size: 0.88rem; line-height: 1.6; }

  .wrap-table {
    background: var(--card2);
    border: 1px solid rgba(255,107,107,0.2);
    border-radius: 12px;
    padding: 18px 22px;
    margin-bottom: 16px;
  }
  .wrap-table .tag {
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--accent2);
    margin-bottom: 12px;
  }
  .wrap-table .row {
    display: flex;
    gap: 12px;
    padding: 7px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    font-size: 0.9rem;
    color: var(--muted);
  }
  .wrap-table .row:last-child { border-bottom: none; }
  .wrap-table .row .val { color: var(--accent2); font-family: 'Courier New', monospace; min-width: 60px; }
  .wrap-table .row .arrow { color: rgba(255,255,255,0.2); }
  .wrap-table .row .result { color: var(--accent3); font-family: 'Courier New', monospace; min-width: 40px; }

  .steps-list {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 22px 26px;
    margin-bottom: 16px;
  }
  .steps-list .step-item {
    display: flex;
    gap: 16px;
    padding: 12px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  .steps-list .step-item:last-child { border-bottom: none; padding-bottom: 0; }
  .steps-list .step-item:first-child { padding-top: 0; }
  .step-num {
    font-family: 'Syne', sans-serif;
    font-size: 0.8rem;
    font-weight: 700;
    color: var(--accent);
    background: rgba(91,240,200,0.12);
    border: 1px solid rgba(91,240,200,0.3);
    border-radius: 50%;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-top: 2px;
  }
  .step-body-text { color: var(--muted); font-size: 0.93rem; }
  .step-body-text strong { color: var(--text); display: block; margin-bottom: 4px; }

  .summary {
    background: linear-gradient(135deg, rgba(91,240,200,0.08), rgba(116,185,255,0.06));
    border: 1px solid rgba(91,240,200,0.2);
    border-radius: 14px;
    padding: 22px 26px;
    margin-bottom: 16px;
  }
  .summary .summary-label {
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 12px;
  }
  .summary p { color: var(--muted); }
  .summary p + p { margin-top: 8px; }

  code {
    background: rgba(91,240,200,0.1);
    color: var(--accent);
    padding: 2px 7px;
    border-radius: 5px;
    font-size: 0.88em;
    font-family: 'Courier New', monospace;
  }
</style>
</head>
<body>
<div class="container">

  <div class="label">Concept Note</div>
  <h1>Why <span>Clip &amp; Convert</span> to uint8?</h1>
  <p class="subtitle">FFT â†” IFFT is mathematically lossless, but computationally imperfect</p>

  <div class="card">
    <p>When you apply an FFT to an image, manipulate the frequency domain (blur, sharpen, filter, etc.), then run an IFFT to reconstruct the image, you're doing a round-trip through complex floating-point math. That process introduces two issues.</p>
  </div>

  <div class="compare">
    <div class="compare-box issue1">
      <div class="tag">Issue 1 â€” Floating-Point Rounding</div>
      <p>CPUs can't represent most decimals exactly in binary. Multiplying complex numbers, summing thousands of frequency components, and dividing accumulate tiny rounding errors. A pixel that was <code>200</code> might come back as <code>200.0000000003</code> or <code>199.9999999997</code>.</p>
    </div>
    <div class="compare-box issue2">
      <div class="tag">Issue 2 â€” Broken Amplitude Balance</div>
      <p>Modifying the spectrum (suppressing frequencies, zeroing bands) changes the energy balance of the signal. The IFFT reconstructs from those modified components â€” nothing guarantees the output stays within <code>[0, 255]</code>. Edge pixels can easily exceed 255 or drop below 0.</p>
    </div>
  </div>

  <div class="danger">
    <strong>Why it matters â€” uint8 wraps around, it doesn't clamp.</strong> Calling <code>.astype(np.uint8)</code> without clipping first causes NumPy to wrap overflowed values, not saturate them.
  </div>

  <div class="wrap-table">
    <div class="tag">âš  Wraparound corruption examples</div>
    <div class="row"><span class="val">256</span><span class="arrow">â†’</span><span class="result">0</span><span>(black instead of white)</span></div>
    <div class="row"><span class="val">260</span><span class="arrow">â†’</span><span class="result">4</span><span>(nearly black instead of bright)</span></div>
    <div class="row"><span class="val">-1</span><span class="arrow">â†’</span><span class="result">255</span><span>(white instead of black)</span></div>
  </div>

  <div class="callout">
    <div class="callout-label">ðŸ’¥ Result</div>
    Vivid, random-looking corruption artifacts scattered across the image â€” not a subtle degradation, but visually broken pixels that have nothing to do with the original content.
  </div>

  <div class="steps-list">
    <div class="step-item">
      <div class="step-num">1</div>
      <div class="step-body-text">
        <strong><code>np.clip(result, 0, 255)</code></strong>
        Hard-clamps every float to the valid range. <code>201.7</code> stays <code>201.7</code>. <code>-3.2</code> becomes <code>0.0</code>. <code>270.5</code> becomes <code>255.0</code>. No wraparound possible after this step.
      </div>
    </div>
    <div class="step-item">
      <div class="step-num">2</div>
      <div class="step-body-text">
        <strong><code>.astype(np.uint8)</code></strong>
        Truncates the decimal and packs values into 8-bit integers â€” the format every image viewer and file format expects. Safe to do only after clipping.
      </div>
    </div>
  </div>

  <div class="highlight">
    <strong>Always chain them together:</strong> <code>np.clip(result, 0, 255).astype(np.uint8)</code> â€” clamp first, then cast. Reversing the order defeats the purpose entirely.
  </div>

  <div class="summary">
    <div class="summary-label">âœ¦ Bottom Line</div>
    <p>FFT round-trips are mathematically exact but floating-point arithmetic is not. Pixel values can drift outside <code>[0, 255]</code> from rounding, and <em>will</em> exceed it if you modify the frequency spectrum.</p>
    <p>Without <code>np.clip</code>, <code>.astype(np.uint8)</code> silently corrupts the image through wraparound. The clip step costs almost nothing and prevents visually broken output.</p>
  </div>

</div>
</body>
</html>
